#!/usr/bin/env node
var logger = require('loge');
var commands = require('./commands');
var models = require('../models');

var yargs = require('yargs')
  .usage('Usage: $0 -f ScienceArticle.pdf [-o 1:0]')
  .describe({
    filename: 'pdf file to open',
    // dump targets
    trailer: 'dump trailer',
    catalog: 'dump trailer Root',
    info: 'dump trailer Info',
    xref: 'dump cross references',
    pages: 'dump pages',
    object: 'object(s) to dump (repeatable)',
    enhance: 'enhance objects when possible',
    // cli meta
    help: 'print this help message',
    verbose: 'print extra output',
  })
  .alias({
    verbose: 'v',
    filename: 'f',
    object: 'o',
    enhance: 'e',
  })
  .string(['object'])
  .demand(['filename'])
  .boolean(['help', 'verbose', 'trailer', 'xref', 'pages', 'enhance']);

var argv = yargs.argv;
logger.level = argv.verbose ? 'debug' : 'info';

if (argv.help) {
  yargs.showHelp();
}
else if (argv.version) {
  console.log(require('../package').version);
}
else {
  var objects = [].concat(argv.object || []).map(models.IndirectReference.fromString);
  commands.dump(argv.filename, argv.trailer, argv.catalog, argv.info, argv.xref, argv.pages, objects, argv.enhance);
}
